!function(){"use strict";angular.module("sync",["socketio-auth"]).config(["$socketioProvider",function(n){n.setDebug(!0)}])}(),function(){"use strict";function n(){function n(n){c=n}function e(){return c}function t(){return u.length}function i(n){u.push({timestamp:Date.now(),collect:n}),s||a.schedule()}function r(){return c?(s=!0,void setTimeout(function(){a.run(),u.length>0?r():s=!1},1e3*c)):void a.run()}function o(){for(var n=Date.now()-1e3*c;u.length>0&&u[0].timestamp<=n;)u.shift().collect()}var u=[],c=2,s=!1,a={setSeconds:n,getSeconds:e,dispose:i,schedule:r,run:o,getItemCount:t};return a}angular.module("sync").factory("$syncGarbageCollector",n)}(),function(){"use strict";function n(){function n(i,r,o){if(!i)return r;var u={};for(var c in r)_.isArray(r[c])?u[c]=e(i[c],r[c],o):_.isFunction(r[c])?u[c]=r[c]:_.isObject(r[c])?u[c]=n(i[c],r[c],o):u[c]=r[c];return t(i),_.assign(i,u),i}function e(e,t,i){if(!e)return t;var r=[];return t.forEach(function(t){if(!_.isArray(t)&&_.isObject(t))if(angular.isDefined(t.id))r.push(n(_.find(e,{id:t.id}),t,i));else{if(i)throw new Error("objects in array must have an id otherwise we can't maintain the instance reference. "+JSON.stringify(t));r.push(t)}else r.push(t)}),e.length=0,Array.prototype.push.apply(e,r),e}function t(n){Object.keys(n).forEach(function(e){delete n[e]})}return{merge:n,clearObject:t}}angular.module("sync").factory("$syncMerge",n)}(),function(){"use strict";function n(){function n(n,e,t,i,r){function o(n,t,i){var r=e.defer(),o=c(n).setObjectClass(i),u=setTimeout(function(){o.ready||(o.destroy(),r.reject("SYNC_TIMEOUT"))},1e3*v);return o.setParameters(t).waitForDataReady().then(function(){clearTimeout(u),r.resolve(o)})["catch"](function(){clearTimeout(u),o.destroy(),r.reject("Failed to subscribe to publication "+n+" failed")}),r.promise}function u(){return v}function c(n,e){return new f(n,e)}function s(){t.on("SYNC_NOW",function(n,e){var t=h[n.name];if(t)for(var i in t)t[i](n);e("SYNCED")})}function a(n,e){var t=y++,i=h[n];return i||(h[n]=i={}),i[t]=e,function(){delete i[t]}}function f(o,u){function c(){S()}function s(n){return V&&V(),V=M(n),cn}function f(n){return n&&cn.syncOff(),cn}function l(n){Q=!0}function h(n){return K?cn:(tn=n,X=function(n){return new tn(n)},b(W),cn)}function y(){return tn}function v(n,e){return un&&angular.equals(n,sn)?cn:(S(),W||(B.length=0),sn=n||{},e=e||{},angular.isDefined(e.single)&&b(e.single),w(),cn)}function g(){return K.promise.then(function(){return cn})}function p(){return K.promise}function b(n){if(K)return cn;var e;return W=n,n?(e=J,B=tn?new tn({}):{}):(e=U,B=[]),z=function(n){try{e(n)}catch(t){throw t.message="Received Invalid object from publication ["+o+"]: "+JSON.stringify(n)+". DETAILS: "+t.message,t}},cn}function O(){return B}function w(){return un?K.promise:(K=e.defer(),H=!1,un=!0,E(),$(),K.promise)}function S(){K&&K.resolve(O()),un&&(C(),un=!1,nn&&(nn(),nn=null),Z&&(Z(),Z=null))}function j(){return un}function $(){nn||(_(),R())}function D(n){return K?cn:(en&&en(),on=n,en=on.$on("$destroy",c),cn)}function _(n){setTimeout(function(){Z=on.$on("user_connected",function(){E()})},n?0:2e3)}function E(){t.fetch("sync.subscribe",{version:m,id:rn,publication:o,params:sn}).then(function(n){rn=n})}function C(){rn&&(t.fetch("sync.unsubscribe",{version:m,id:rn}),rn=null)}function R(){nn=a(o,function(n){(rn===n.subscriptionId||!rn&&T(n.params))&&(n.diff||(an={},W||(B.length=0)),F(n.records),H||(H=!0,K.resolve(O())))})}function T(n){if(!sn||0==Object.keys(sn).length)return!0;var e=!0;for(var t in n)if(n[t]!==sn[t]){e=!1;break}return e}function F(n){var e,t=[];cn.ready=!1,n.forEach(function(n){n.remove?G(n):e=an[n.id]?q(n):P(n),e&&t.push(e)}),cn.ready=!0,W?fn.notify("ready",O()):fn.notify("ready",O(),t)}function k(){return this.ready}function N(n){return fn.on("add",n)}function A(n){return fn.on("update",n)}function I(n){return fn.on("remove",n)}function M(n){return fn.on("ready",n)}function P(n){return L(n),z(X?X(n):n),fn.notify("add",n),n}function q(n){var e=an[n.id];return L(n)<=L(e)?null:(z(X?X(n):n),fn.notify("update",n),n)}function G(n){var e=an[n.id];(!e||L(n)>L(e))&&(n.removed=!0,z(n),e&&(fn.notify("remove",n),Y(n)))}function Y(n){i.dispose(function(){var e=an[n.id];e&&n.revision>=e.revision&&delete an[n.id]})}function x(n){return!!an[n]}function J(n){an[n.id]=n,n.remove?r.clearObject(B):r.merge(B,n,Q)}function U(n){var e=an[n.id];e?(r.merge(e,n,Q),n.removed&&B.splice(B.indexOf(e),1)):(an[n.id]=n,n.removed||B.push(n))}function L(n){if(angular.isDefined(n.revision))return n.revision;if(angular.isDefined(n.timestamp))return n.timestamp;throw new Error("Sync requires a revision or timestamp property in received "+(tn?"object ["+tn.name+"]":"record"))}var W,z,B,H,K,Q,V,X,Z,nn,en,tn,rn,on,un=!1,cn=this,sn={},an={},fn=new d;this.ready=!1,this.syncOn=w,this.syncOff=S,this.setOnReady=s,this.onReady=M,this.onUpdate=A,this.onAdd=N,this.onRemove=I,this.getData=O,this.setParameters=v,this.waitForDataReady=p,this.waitForSubscriptionReady=g,this.setForce=f,this.isSyncing=j,this.isReady=k,this.setSingle=b,this.setObjectClass=h,this.getObjectClass=y,this.setStrictMode=l,this.attach=D,this.destroy=c,this.isExistingStateFor=x,b(!1),D(u||n)}function d(){function n(n,e,i){var r=t[n];r&&_.forEach(r,function(n,t){n(e,i)})}function e(n,e){var r=t[n];r||(r=t[n]={});var o=i++;return r[o++]=e,function(){delete r[o]}}var t={},i=0;this.notify=n,this.on=e}function l(){return{log:function(n){},debug:function(n){}}}var h={},y=0,v=8,m="1.1";l();s();var g={subscribe:c,resolveSubscription:o,getGracePeriod:u};return g}this.$get=[$sync,n($rootScope,$q,$socketio,$syncGarbageCollector,$syncMerge)]}angular.module("sync").provider("$sync",n)}();