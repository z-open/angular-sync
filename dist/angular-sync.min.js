!function(){"use strict";angular.module("sync",["socketio-auth"]).config(["$socketioProvider",function(n){n.setDebug(!0)}])}(),function(){"use strict";function n(){function n(n){c=n}function t(){return c}function e(){return u.length}function i(n){u.push({timestamp:Date.now(),collect:n}),s||f.schedule()}function r(){return c?(s=!0,void setTimeout(function(){f.run(),u.length>0?r():s=!1},1e3*c)):void f.run()}function o(){for(var n=Date.now()-1e3*c;u.length>0&&u[0].timestamp<=n;)u.shift().collect()}var u=[],c=2,s=!1,f={setSeconds:n,getSeconds:t,dispose:i,schedule:r,run:o,getItemCount:e};return f}angular.module("sync").factory("$syncGarbageCollector",n)}(),function(){"use strict";function n(n,t,e,i){function r(n,e,i){var r=t.defer(),o=u(n).setObjectClass(i),c=setTimeout(function(){o.ready||(o.destroy(),r.reject("SYNC_TIMEOUT"))},1e3*v);return o.setParameters(e).waitForDataReady().then(function(){clearTimeout(c),r.resolve(o)})["catch"](function(){clearTimeout(c),o.destroy(),r.reject("Failed to subscribe to publication "+n+" failed")}),r.promise}function o(){return v}function u(n,t){return new f(n,t)}function c(){e.on("SYNC_NOW",function(n,t){var e=l[n.name];if(e)for(var i in e)e[i](n);t("SYNCED")})}function s(n,t){var e=h++,i=l[n];return i||(l[n]=i={}),i[e]=t,function(){delete i[e]}}function f(r,o){function u(){O()}function c(n){return L&&L(),L=P(n),on}function f(n){return n&&on.syncOff(),on}function d(n){return K?on:(nn=n,Q=function(n){return new nn(n)},g(z),on)}function l(){return nn}function h(n,t){return rn&&angular.equals(n,un)?on:(O(),z||(H.length=0),un=n||{},t=t||{},angular.isDefined(t.single)&&g(t.single),b(),on)}function v(){return K.promise.then(function(){return on})}function m(){return K.promise}function g(n){return K?on:(z=n,n?(B=U,H=nn?new nn({}):{}):(B=A,H=[]),on)}function p(){return H}function b(){return rn?K.promise:(K=t.defer(),J=!1,rn=!0,j(),w(),K.promise)}function O(){K&&K.resolve(p()),rn&&(C(),rn=!1,X&&(X(),X=null),V&&(V(),V=null))}function S(){return rn}function w(){X||(D(),E())}function $(n){return K?on:(Z&&Z(),en=n,Z=en.$on("$destroy",u),on)}function D(n){setTimeout(function(){V=en.$on("user_connected",function(){j()})},n?0:2e3)}function j(){e.fetch("sync.subscribe",{version:y,id:tn,publication:r,params:un}).then(function(n){tn=n})}function C(){tn&&(e.fetch("sync.unsubscribe",{version:y,id:tn}),tn=null)}function E(){X=s(r,function(n){(tn===n.subscriptionId||!tn&&R(n.params))&&(n.diff||(cn={},z||(H.length=0)),T(n.records),J||(J=!0,K.resolve(p())))})}function R(n){if(!un||0==Object.keys(un).length)return!0;var t=!0;for(var e in n)if(n[e]!==un[e]){t=!1;break}return t}function T(n){var t,e=[];on.ready=!1,n.forEach(function(n){n.remove?G(n):t=cn[n.id]?q(n):_(n),t&&e.push(t)}),on.ready=!0,z?sn.notify("ready",p()):sn.notify("ready",p(),e)}function k(){return this.ready}function F(n){return sn.on("add",n)}function x(n){return sn.on("update",n)}function N(n){return sn.on("remove",n)}function P(n){return sn.on("ready",n)}function _(n){return W(n),B(Q?Q(n):n),sn.notify("add",n),n}function q(n){var t=cn[n.id];return W(n)<=W(t)?null:(B(Q?Q(n):n),sn.notify("update",n),n)}function G(n){var t=cn[n.id];(!t||W(n)>W(t))&&(n.removed=!0,B(n),t&&(sn.notify("remove",n),I(n)))}function I(n){i.dispose(function(){var t=cn[n.id];t&&n.revision>=t.revision&&delete cn[n.id]})}function Y(n){return!!cn[n]}function U(n){cn[n.id]=n,M(H),n.remove||angular.extend(H,n)}function A(n){var t=cn[n.id];t?(M(t),angular.extend(t,n),n.removed&&H.splice(H.indexOf(t),1)):(cn[n.id]=n,n.removed||H.push(n))}function M(n){Object.keys(n).forEach(function(t){delete n[t]})}function W(n){if(angular.isDefined(n.revision))return n.revision;if(angular.isDefined(n.timestamp))return n.timestamp;throw new Error("Sync requires a revision or timestamp property in received "+(nn?"object ["+nn.name+"]":"record"))}var z,B,H,J,K,L,Q,V,X,Z,nn,tn,en,rn=!1,on=this,un={},cn={},sn=new a;this.ready=!1,this.syncOn=b,this.syncOff=O,this.setOnReady=c,this.onReady=P,this.onUpdate=x,this.onAdd=F,this.onRemove=N,this.getData=p,this.setParameters=h,this.waitForDataReady=m,this.waitForSubscriptionReady=v,this.setForce=f,this.isSyncing=S,this.isReady=k,this.setSingle=g,this.setObjectClass=d,this.getObjectClass=l,this.attach=$,this.destroy=u,this.isExistingStateFor=Y,g(!1),$(o||n)}function a(){function n(n,t,i){var r=e[n];r&&_.forEach(r,function(n,e){n(t,i)})}function t(n,t){var r=e[n];r||(r=e[n]={});var o=i++;return r[o++]=t,function(){delete r[o]}}var e={},i=0;this.notify=n,this.on=t}function d(){return{log:function(n){},debug:function(n){}}}var l={},h=0,v=8,y="1.1";d();c();var m={subscribe:u,resolveSubscription:r,getGracePeriod:o};return m}n.$inject=["$rootScope","$q","$socketio","$syncGarbageCollector"],angular.module("sync").factory("$sync",n)}();