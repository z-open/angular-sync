!function(){"use strict";angular.module("sync",["socketio-auth"]).config(["$socketioProvider",function(n){n.setDebug(!0)}])}(),function(){"use strict";function n(){function n(n){c=n}function t(){return c}function e(){return u.length}function i(n){u.push({timestamp:Date.now(),collect:n}),s||f.schedule()}function r(){return c?(s=!0,void setTimeout(function(){f.run(),u.length>0?r():s=!1},1e3*c)):void f.run()}function o(){for(var n=Date.now()-1e3*c;u.length>0&&u[0].timestamp<=n;)u.shift().collect()}var u=[],c=2,s=!1,f={setSeconds:n,getSeconds:t,dispose:i,schedule:r,run:o,getItemCount:e};return f}angular.module("sync").factory("$syncGarbageCollector",n)}(),function(){"use strict";function n(n,t,e,i){function r(n,e,i){var r=t.defer(),o=u(n).setObjectClass(i),c=setTimeout(function(){o.ready||(o.destroy(),r.reject("SYNC_TIMEOUT"))},1e3*y);return o.setParameters(e).waitForDataReady().then(function(){clearTimeout(c),r.resolve(o)})["catch"](function(){clearTimeout(c),o.destroy(),r.reject("Failed to subscribe to publication "+n+" failed")}),r.promise}function o(){return y}function u(n,t){return new f(n,t)}function c(){e.on("SYNC_NOW",function(n,t){var e=l[n.name];if(e)for(var i in e)e[i](n);t("SYNCED")})}function s(n,t){var e=h++,i=l[n];return i||(l[n]=i={}),i[e]=t,function(){delete i[e]}}function f(r,o){function u(){b()}function c(n){return L&&L(),L=N(n),on}function f(n){return n&&on.syncOff(),on}function d(n){return K?on:(nn=n,Q=function(n){return new nn(n)},m(z),on)}function l(){return nn}function h(n,t){return rn&&angular.equals(n,un)?on:(b(),z||(H.length=0),en=0,un=n||{},t=t||{},angular.isDefined(t.single)&&m(t.single),p(),on)}function y(){return K.promise.then(function(){return on})}function v(){return K.promise}function m(n){return K?on:(z=n,n?(B=Y,H=nn?new nn({}):{}):(B=U,H=[]),on)}function g(){return H}function p(){return rn?K.promise:(K=t.defer(),J=!1,rn=!0,D(),S(),K.promise)}function b(){K&&K.resolve(g()),rn&&(j(),rn=!1,X&&(X(),X=null),V&&(V(),V=null))}function O(){return rn}function S(){X||($(),C())}function w(n){return K?on:(Z&&Z(),tn=n,Z=tn.$on("$destroy",u),on)}function $(n){setTimeout(function(){V=tn.$on("user_connected",function(){D()})},n?0:2e3)}function D(){e.fetch("sync.subscribe",{id:W,publication:r,params:un}).then(function(n){W=n})}function j(){W&&(e.fetch("sync.unsubscribe",W),W=null)}function C(){X=s(r,function(n){(W===n.subscriptionId||!W&&E(n.params))&&(n.diff||(cn={},z||(H.length=0)),R(n.records),J||(J=!0,K.resolve(g())))})}function E(n){if(!un||0==Object.keys(un).length)return!0;var t=!0;for(var e in n)if(n[e]!==un[e])break;return t}function R(n){var t,e=[];on.ready=!1,n.forEach(function(n){n.remove?q(n):t=cn[n.id]?_(n):P(n),t&&e.push(t)}),on.ready=!0,z?sn.notify("ready",g()):sn.notify("ready",g(),e)}function T(){return this.ready}function k(n){return sn.on("add",n)}function F(n){return sn.on("update",n)}function x(n){return sn.on("remove",n)}function N(n){return sn.on("ready",n)}function P(n){return M(n),B(Q?Q(n):n),sn.notify("add",n),n}function _(n){var t=cn[n.id];return M(n)<=M(t)?null:(B(Q?Q(n):n),sn.notify("update",n),n)}function q(n){var t=cn[n.id];(!t||M(n)>M(t))&&(n.removed=!0,B(n),t&&(sn.notify("remove",n),G(n)))}function G(n){i.dispose(function(){var t=cn[n.id];t&&n.revision>=t.revision&&delete cn[n.id]})}function I(n){return!!cn[n]}function Y(n){cn[n.id]=n,A(H),n.remove||angular.extend(H,n)}function U(n){var t=cn[n.id];t?(A(t),angular.extend(t,n),n.removed&&H.splice(H.indexOf(t),1)):(cn[n.id]=n,n.removed||H.push(n))}function A(n){Object.keys(n).forEach(function(t){delete n[t]})}function M(n){if(angular.isDefined(n.revision))return n.revision;if(angular.isDefined(n.timestamp))return n.timestamp;throw new Error("Sync requires a revision or timestamp property in received "+(nn?"object ["+nn.name+"]":"record"))}var W,z,B,H,J,K,L,Q,V,X,Z,nn,tn,en=0,rn=!1,on=this,un={},cn={},sn=new a;this.ready=!1,this.syncOn=p,this.syncOff=b,this.setOnReady=c,this.onReady=N,this.onUpdate=F,this.onAdd=k,this.onRemove=x,this.getData=g,this.setParameters=h,this.waitForDataReady=v,this.waitForSubscriptionReady=y,this.setForce=f,this.isSyncing=O,this.isReady=T,this.setSingle=m,this.setObjectClass=d,this.getObjectClass=l,this.attach=w,this.destroy=u,this.isExistingStateFor=I,m(!1),w(o||n)}function a(){function n(n,t,i){var r=e[n];r&&_.forEach(r,function(n,e){n(t,i)})}function t(n,t){var r=e[n];r||(r=e[n]={});var o=i++;return r[o++]=t,function(){delete r[o]}}var e={},i=0;this.notify=n,this.on=t}function d(){return{log:function(n){},debug:function(n){}}}var l={},h=0,y=8;d();c();var v={subscribe:u,resolveSubscription:r,getGracePeriod:o};return v}n.$inject=["$rootScope","$q","$socketio","$syncGarbageCollector"],angular.module("sync").factory("$sync",n)}();