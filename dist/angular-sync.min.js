!function(){"use strict";angular.module("sync",["socketio-auth"]).config(["$socketioProvider",function(n){n.setDebug(!0)}])}(),function(){"use strict";function n(){function n(n){c=n}function e(){return c}function t(){return u.length}function r(n){u.push({timestamp:Date.now(),collect:n}),s||a.schedule()}function i(){return c?(s=!0,void setTimeout(function(){a.run(),u.length>0?i():s=!1},1e3*c)):void a.run()}function o(){for(var n=Date.now()-1e3*c;u.length>0&&u[0].timestamp<=n;)u.shift().collect()}var u=[],c=2,s=!1,a={setSeconds:n,getSeconds:e,dispose:r,schedule:i,run:o,getItemCount:t};return a}angular.module("sync").factory("$syncGarbageCollector",n)}(),function(){"use strict";function n(){function n(r,i){if(!r)return i;var o={};for(var u in i)_.isArray(i[u])?o[u]=e(r[u],i[u]):_.isFunction(i[u])?o[u]=i[u]:_.isObject(i[u])?o[u]=n(r[u],i[u]):o[u]=i[u];return t(r),_.assign(r,o),r}function e(e,t){if(!e)return t;var r=[];return t.forEach(function(t){if(!_.isArray(t)&&_.isObject(t)){if(!angular.isDefined(t.id))throw new Error("objects in array must have an id otherwise we can't maintain the instance reference. "+JSON.stringify(t));r.push(n(_.find(e,{id:t.id}),t))}else r.push(t)}),e.length=0,Array.prototype.push.apply(e,r),e}function t(n){Object.keys(n).forEach(function(e){delete n[e]})}return{merge:n,clearObject:t}}angular.module("sync").factory("$syncMerge",n)}(),function(){"use strict";function n(n,e,t,r,i){function o(n,t,r){var i=e.defer(),o=c(n).setObjectClass(r),u=setTimeout(function(){o.ready||(o.destroy(),i.reject("SYNC_TIMEOUT"))},1e3*v);return o.setParameters(t).waitForDataReady().then(function(){clearTimeout(u),i.resolve(o)})["catch"](function(){clearTimeout(u),o.destroy(),i.reject("Failed to subscribe to publication "+n+" failed")}),i.promise}function u(){return v}function c(n,e){return new f(n,e)}function s(){t.on("SYNC_NOW",function(n,e){var t=h[n.name];if(t)for(var r in t)t[r](n);e("SYNCED")})}function a(n,e){var t=y++,r=h[n];return r||(h[n]=r={}),r[t]=e,function(){delete r[t]}}function f(o,u){function c(){w()}function s(n){return L&&L(),L=P(n),on}function f(n){return n&&on.syncOff(),on}function l(n){return K?on:(nn=n,Q=function(n){return new nn(n)},p(W),on)}function h(){return nn}function y(n,e){return rn&&angular.equals(n,un)?on:(w(),W||(B.length=0),un=n||{},e=e||{},angular.isDefined(e.single)&&p(e.single),O(),on)}function v(){return K.promise.then(function(){return on})}function g(){return K.promise}function p(n){return K?on:(W=n,n?(z=x,B=nn?new nn({}):{}):(z=U,B=[]),on)}function b(){return B}function O(){return rn?K.promise:(K=e.defer(),H=!1,rn=!0,_(),S(),K.promise)}function w(){K&&K.resolve(b()),rn&&(C(),rn=!1,X&&(X(),X=null),V&&(V(),V=null))}function j(){return rn}function S(){X||(D(),E())}function $(n){return K?on:(Z&&Z(),tn=n,Z=tn.$on("$destroy",c),on)}function D(n){setTimeout(function(){V=tn.$on("user_connected",function(){_()})},n?0:2e3)}function _(){t.fetch("sync.subscribe",{version:m,id:en,publication:o,params:un}).then(function(n){en=n})}function C(){en&&(t.fetch("sync.unsubscribe",{version:m,id:en}),en=null)}function E(){X=a(o,function(n){(en===n.subscriptionId||!en&&F(n.params))&&(n.diff||(cn={},W||(B.length=0)),R(n.records),H||(H=!0,K.resolve(b())))})}function F(n){if(!un||0==Object.keys(un).length)return!0;var e=!0;for(var t in n)if(n[t]!==un[t]){e=!1;break}return e}function R(n){var e,t=[];on.ready=!1,n.forEach(function(n){n.remove?I(n):e=cn[n.id]?G(n):q(n),e&&t.push(e)}),on.ready=!0,W?sn.notify("ready",b()):sn.notify("ready",b(),t)}function T(){return this.ready}function k(n){return sn.on("add",n)}function N(n){return sn.on("update",n)}function A(n){return sn.on("remove",n)}function P(n){return sn.on("ready",n)}function q(n){return J(n),z(Q?Q(n):n),sn.notify("add",n),n}function G(n){var e=cn[n.id];return J(n)<=J(e)?null:(z(Q?Q(n):n),sn.notify("update",n),n)}function I(n){var e=cn[n.id];(!e||J(n)>J(e))&&(n.removed=!0,z(n),e&&(sn.notify("remove",n),M(n)))}function M(n){r.dispose(function(){var e=cn[n.id];e&&n.revision>=e.revision&&delete cn[n.id]})}function Y(n){return!!cn[n]}function x(n){cn[n.id]=n,n.remove?i.clearObject(B):i.merge(B,n)}function U(n){var e=cn[n.id];e?(i.merge(e,n),n.removed&&B.splice(B.indexOf(e),1)):(cn[n.id]=n,n.removed||B.push(n))}function J(n){if(angular.isDefined(n.revision))return n.revision;if(angular.isDefined(n.timestamp))return n.timestamp;throw new Error("Sync requires a revision or timestamp property in received "+(nn?"object ["+nn.name+"]":"record"))}var W,z,B,H,K,L,Q,V,X,Z,nn,en,tn,rn=!1,on=this,un={},cn={},sn=new d;this.ready=!1,this.syncOn=O,this.syncOff=w,this.setOnReady=s,this.onReady=P,this.onUpdate=N,this.onAdd=k,this.onRemove=A,this.getData=b,this.setParameters=y,this.waitForDataReady=g,this.waitForSubscriptionReady=v,this.setForce=f,this.isSyncing=j,this.isReady=T,this.setSingle=p,this.setObjectClass=l,this.getObjectClass=h,this.attach=$,this.destroy=c,this.isExistingStateFor=Y,p(!1),$(u||n)}function d(){function n(n,e,r){var i=t[n];i&&_.forEach(i,function(n,t){n(e,r)})}function e(n,e){var i=t[n];i||(i=t[n]={});var o=r++;return i[o++]=e,function(){delete i[o]}}var t={},r=0;this.notify=n,this.on=e}function l(){return{log:function(n){},debug:function(n){}}}var h={},y=0,v=8,m="1.1";l();s();var g={subscribe:c,resolveSubscription:o,getGracePeriod:u};return g}n.$inject=["$rootScope","$q","$socketio","$syncGarbageCollector","$syncMerge"],angular.module("sync").factory("$sync",n)}();